[gd_scene load_steps=9 format=3 uid="uid://b7w36sekibkaq"]

[ext_resource type="Texture2D" uid="uid://c65sij5etggl4" path="res://assets/enemies/rolling/roll.png" id="1_unf0v"]
[ext_resource type="Script" uid="uid://tjos72eulcdo" path="res://scenes/enemies/scripts/rolling/rolling.gd" id="1_ur5jv"]

[sub_resource type="Shader" id="Shader_4tfvt"]
code = "//ATTENTION:
//  THIS IS SHADE AUTOGENERATED BY
//  THE ADDON SPRITE-SHADER-MIXER
//  ANY MANUAL CHANGES WILL BE REMOVED WHEN THE ADDON
//  UPDATES THIS SHADER.
//  ANYWAY, YOU CAN SAVE THE CURRENT VERSION AS A RESOURCE FILE.
//SHADERS:PixelBorder,
shader_type canvas_item;

uniform float opacity:hint_range(0.0, 1.0, 0.01)=1.;

	
	
uniform bool PIXELBORDER_active = true;
uniform float BORDERNOISE_max_line_width:hint_range(0.0, 50.0, 0.1) = 10.0;
uniform float BORDERNOISE_min_line_width:hint_range(0.0, 1000.0, 0.1) = 88.0;
uniform float BORDERNOISE_freq:hint_range(0.0, 12.0, 0.1) = 1.0;
uniform float BORDERNOISE_block_size:hint_range(0.0, 100.0, 0.1) = 20.0;
uniform vec4 BORDERNOISE_starting_colour : source_color= vec4(0,0,0,1);
uniform vec4 BORDERNOISE_ending_colour: source_color = vec4(1,0,0,1);
uniform bool PIXELDISOLVEANI_active=true;
uniform float dissolve_speed :hint_range(1.,5.) = 2.;
uniform float min_value :hint_range(0,1) = .5;
uniform float max_value :hint_range(0,1) = .7;

	
uniform float PIXELDISOLVE_time:hint_range(0.0, 1.57, 0.001) = 1.0;
uniform vec2 PIXELDISOLVE_custom_resolution = vec2(100,100);

const float BORDERNOISE_pi = 3.1415;
const int BORDERNOISE_ang_res = 16;
const int BORDERNOISE_grad_res = 8;

float PIXELDISOLVE_rand(vec2 co){
    return fract(sin(dot(co.xy ,vec2(12.9898,96.233))) * 43758.5453);
}

float sin_range(float x) {
    return min_value + (sin(x) * 0.5 + 0.5) * (max_value - min_value);
}
float BORDERNOISE_hash(vec2 p, float s) {
	return fract(35.1 * sin(dot(vec3(112.3, 459.2, 753.2), vec3(p, s))));
}
float BORDERNOISE_noise(vec2 p, float s) {
	vec2 d = vec2(0, 1)*sin(TIME);
	vec2 b = floor(p)*sin(TIME);
	vec2 f = fract(p);
	return mix(
		mix(BORDERNOISE_hash(b + d.xx, s), BORDERNOISE_hash(b + d.yx, s), f.x),
		mix(BORDERNOISE_hash(b + d.xy, s), BORDERNOISE_hash(b + d.yy, s), f.x), f.y);
}
float BORDERNOISE_getLineWidth(vec2 p, float s) {
	p /= BORDERNOISE_block_size;
	float w = 0.0;
	float intensity = 1.0;
	for (int i = 0; i < 3; i++) {
		w = mix(w, BORDERNOISE_noise(p, s), intensity);
		p /= 2.0;
		intensity /= 2.0;
	}
	
	return mix(BORDERNOISE_max_line_width, BORDERNOISE_min_line_width, w);
}
bool BORDERNOISE_pixelInRange(sampler2D text, vec2 uv, vec2 dist) {
	float alpha = 0.0;
	for (int i = 0; i < BORDERNOISE_ang_res; i++) {
		float angle = 2.0 * BORDERNOISE_pi * float(i) / float(BORDERNOISE_ang_res);
		vec2 disp = dist * vec2(cos(angle), sin(angle));
		if (texture(text, uv + disp).a > 0.0) return true;
	}
	return false;
}
float BORDERNOISE_getClosestDistance(sampler2D text, vec2 uv, vec2 maxDist) {
	if (!BORDERNOISE_pixelInRange(text, uv, maxDist)) return -1.0;
	
	float hi = 1.0; float lo = 0.0;
	
	for (int i = 1; i <= BORDERNOISE_grad_res; i++) {
		float curr = (hi + lo) / 2.0;
		if (BORDERNOISE_pixelInRange(text, uv, curr * maxDist)) {
			hi = curr;
		}
		else {
			lo = curr;
		}
	}
	return hi;
	
}
void pixel_border(in vec2 uv, in sampler2D txt, vec2 size, vec2 pixelSize, inout vec4 color){
	float timeStep = floor(BORDERNOISE_freq * TIME);
	vec2 scaledDist = pixelSize;
	scaledDist *= BORDERNOISE_getLineWidth(uv / pixelSize, timeStep);
	float w = BORDERNOISE_getClosestDistance(txt, uv, scaledDist);
	
	if (( w > 0.0) && (texture(txt, uv).a < 0.2)) {
		color = mix(BORDERNOISE_starting_colour, BORDERNOISE_ending_colour, tanh(3.0*w));
        
    if (texture(txt,uv).a == 0. && color.a > 0. ){
       	vec2 within_texture_pixel = vec2(floor(uv * PIXELDISOLVE_custom_resolution));
       	if(sin(sin_range(TIME * dissolve_speed))  <= PIXELDISOLVE_rand(within_texture_pixel))
      		color = vec4(0.0,0.0,0.0,0.0);
}
	}
}


void fragment() {
	vec4 color = texture(TEXTURE, UV);
	vec2 size = vec2(textureSize(TEXTURE, 0));
	vec2 uv = UV;
	vec2 screen_uv = SCREEN_UV;

	if(PIXELBORDER_active) pixel_border(uv, TEXTURE, size, TEXTURE_PIXEL_SIZE, color);


	color.a*=opacity;
	COLOR=color;
}

void vertex() {
	
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ur5jv"]
shader = SubResource("Shader_4tfvt")
shader_parameter/opacity = 1.0
shader_parameter/PIXELBORDER_active = true
shader_parameter/BORDERNOISE_max_line_width = 2.0
shader_parameter/BORDERNOISE_min_line_width = 0.0
shader_parameter/BORDERNOISE_freq = 1.0
shader_parameter/BORDERNOISE_block_size = 55.6
shader_parameter/BORDERNOISE_starting_colour = Color(0.860369, 0.860369, 0.860369, 1)
shader_parameter/BORDERNOISE_ending_colour = Color(1, 0, 0, 1)
shader_parameter/PIXELDISOLVEANI_active = true
shader_parameter/dissolve_speed = 1.345
shader_parameter/min_value = 0.552
shader_parameter/max_value = 0.693
shader_parameter/PIXELDISOLVE_time = 1.57
shader_parameter/PIXELDISOLVE_custom_resolution = Vector2(100, 100)

[sub_resource type="CircleShape2D" id="CircleShape2D_4tfvt"]
radius = 7.0

[sub_resource type="Animation" id="Animation_ur5jv"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprites:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}

[sub_resource type="Animation" id="Animation_4tfvt"]
resource_name = "rolling"
length = 0.5
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprites:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.25, 0.5),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [0.0, 3.14159, 6.28319]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_14k5f"]
_data = {
&"RESET": SubResource("Animation_ur5jv"),
&"rolling": SubResource("Animation_4tfvt")
}

[node name="rolling" type="CharacterBody2D"]
collision_layer = 4
collision_mask = 27
script = ExtResource("1_ur5jv")
gravity = 100

[node name="Sprites" type="Sprite2D" parent="."]
unique_name_in_owner = true
material = SubResource("ShaderMaterial_ur5jv")
position = Vector2(-1, -1)
texture = ExtResource("1_unf0v")
offset = Vector2(-4, -1.28571)

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
visible = false
position = Vector2(0, -1)
shape = SubResource("CircleShape2D_4tfvt")

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
path_desired_distance = 5.0
target_desired_distance = 5.0
navigation_layers = 2
path_postprocessing = 1
avoidance_enabled = true
max_speed = 130.0

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_14k5f")
}
autoplay = "rolling"

[connection signal="velocity_computed" from="NavigationAgent2D" to="." method="_on_navigation_agent_2d_velocity_computed"]
