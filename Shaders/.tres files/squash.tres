[gd_resource type="ShaderMaterial" load_steps=2 format=3 uid="uid://c8mr45op7h2w2"]

[sub_resource type="Shader" id="Shader_xtekn"]
code = "//ATTENTION:
//  THIS IS SHADE AUTOGENERATED BY
//  THE ADDON SPRITE-SHADER-MIXER
//  ANY MANUAL CHANGES WILL BE REMOVED WHEN THE ADDON
//  UPDATES THIS SHADER.
//  ANYWAY, YOU CAN SAVE THE CURRENT VERSION AS A RESOURCE FILE.
//SHADERS:Squash,
shader_type canvas_item;

uniform float opacity:hint_range(0.0, 1.0, 0.01)=1.;

	
/*
Squish Sprite Shader by Garmelon (https://github.com/Garmelon)
Documented by Mateus-Carmo31
*/

uniform bool squash_active = true;
uniform bool uv_mode = false;
uniform float y_factor : hint_range(-1.,3.) = 2.;
uniform float squash : hint_range(-1,3) = 1;


float squash_function(float y)
{
	return sqrt(1.0 - y*y);
}

void squash_func(in vec2 uv, in sampler2D tex, in vec2 size, in vec2 pixelSize, inout vec4 color){

// This will be used to center the laser
    uv =  uv * 2.0 - 1.0;
	uv.y *= 1. / y_factor;
	float displacement = 1.0 + squash * squash_function(uv.y);
	uv.y /= displacement;
	uv = (uv + 1.0) / 2.0;


	
if (uv_mode)
{
    color = uv.y >= 0.0 && uv.y <= 1.0 ? vec4(uv, 0.0, 1.0) : vec4(vec3(0.0), 1.0);
}
else if (uv.y >= 0.0 && uv.y <= 1.0)
{
    color = texture(tex, uv);
}
else
{
    color = vec4(0.0);
}
}



void fragment() {
	vec4 color = texture(TEXTURE, UV);
	vec2 size = vec2(textureSize(TEXTURE, 0));
	vec2 uv = UV;
	vec2 screen_uv = SCREEN_UV;

	if(squash_active) squash_func(uv, TEXTURE, size, TEXTURE_PIXEL_SIZE, color);


	color.a*=opacity;
	COLOR=color;
}

void vertex() {
	
}
"

[resource]
shader = SubResource("Shader_xtekn")
shader_parameter/opacity = 1.0
shader_parameter/squash_active = true
shader_parameter/uv_mode = false
shader_parameter/y_factor = 2.0
shader_parameter/squash = 1.0
